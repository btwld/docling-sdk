<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Docling Web OCR</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'media',
    };
  </script>
  <style>
    /* Shimmer animation for progress bars */
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    .shimmer {
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    /* Custom scrollbar */
    pre::-webkit-scrollbar { width: 6px; height: 6px; }
    pre::-webkit-scrollbar-track { background: transparent; }
    pre::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 3px; }
    pre::-webkit-scrollbar-thumb:hover { background: #6b7280; }
  </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <h1 class="text-2xl font-bold">Docling Web OCR</h1>
      <div class="flex items-center gap-4">
        <button id="load-btn"
          class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors">
          Load Model
        </button>
        <div id="model-status" class="hidden flex items-center gap-2">
          <span class="w-2.5 h-2.5 rounded-full bg-green-500"></span>
          <span class="text-sm font-medium text-green-600 dark:text-green-400">Model Ready</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Loading Modal -->
  <div id="loading-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center">
    <div class="bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
      <h2 class="text-lg font-semibold mb-1">Loading Model</h2>
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">First-time download is ~500MB. Cached for future use.</p>
      <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-2 overflow-hidden">
        <div id="loading-progress-bar"
          class="h-full bg-blue-600 rounded-full transition-all duration-300 ease-out relative"
          style="width: 0%">
          <div class="shimmer absolute inset-0 rounded-full"></div>
        </div>
      </div>
      <div class="flex justify-between text-sm">
        <span id="loading-status" class="text-gray-500 dark:text-gray-400 truncate max-w-[70%]">Initializing...</span>
        <span id="loading-percent" class="font-medium">0%</span>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

      <!-- Left Column: Input -->
      <div class="space-y-6">

        <!-- Status -->
        <p id="status-text" class="text-sm text-gray-500 dark:text-gray-400">Load the model to get started</p>

        <!-- Image Uploader -->
        <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
          <h2 class="text-lg font-semibold mb-4">Upload Image</h2>
          <div id="drop-zone"
            class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-gray-400 dark:hover:border-gray-500 transition-colors min-h-[200px] flex flex-col items-center justify-center">
            <svg class="w-12 h-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
            <p class="text-sm font-medium text-gray-600 dark:text-gray-300">Drag and drop an image</p>
            <p class="text-xs text-gray-400 mt-1">or click to browse</p>
            <p class="text-xs text-gray-400 mt-2">Supports PNG, JPG, WebP, GIF</p>
            <input id="file-input" type="file" accept="image/*" class="hidden" />
          </div>
        </div>

        <!-- Image Preview -->
        <div id="preview-container" class="hidden bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
          <h2 class="text-lg font-semibold mb-4">Preview</h2>
          <img id="image-preview" class="max-w-full rounded-lg" alt="Uploaded image" />
        </div>

        <!-- Processing Panel -->
        <div id="processing-panel" class="hidden bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
          <h2 class="text-lg font-semibold mb-4">Processing</h2>
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-2 overflow-hidden">
            <div id="processing-progress-bar"
              class="h-full bg-green-500 rounded-full transition-all duration-300 ease-out relative"
              style="width: 0%">
              <div class="shimmer absolute inset-0 rounded-full"></div>
            </div>
          </div>
          <p id="processing-status" class="text-xs text-gray-500 dark:text-gray-400 mb-4">Starting...</p>
          <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3">
            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1 font-medium">Streamed Output</p>
            <pre id="streamed-raw" class="text-xs font-mono whitespace-pre-wrap max-h-64 overflow-y-auto text-gray-700 dark:text-gray-300"></pre>
          </div>
        </div>
      </div>

      <!-- Right Column: Results -->
      <div id="results-container" class="hidden bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 min-h-[600px] flex flex-col">

        <!-- Tab bar -->
        <div class="border-b border-gray-200 dark:border-gray-700 overflow-x-auto">
          <nav class="flex whitespace-nowrap px-4">
            <button data-tab="tab-preview" class="px-3 py-3 text-sm font-medium border-b-2 text-blue-600 dark:text-blue-400 border-blue-600 transition-colors">
              Preview
            </button>
            <button data-tab="tab-markdown" class="px-3 py-3 text-sm font-medium border-b-2 text-gray-500 border-transparent hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
              Markdown
            </button>
            <button data-tab="tab-text" class="px-3 py-3 text-sm font-medium border-b-2 text-gray-500 border-transparent hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
              Text
            </button>
            <button data-tab="tab-tables" class="px-3 py-3 text-sm font-medium border-b-2 text-gray-500 border-transparent hover:text-gray-700 dark:hover:text-gray-300 transition-colors relative">
              Tables
              <span id="table-badge" class="hidden ml-1 px-1.5 py-0.5 text-xs rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400">0</span>
            </button>
            <button data-tab="tab-json" class="px-3 py-3 text-sm font-medium border-b-2 text-gray-500 border-transparent hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
              JSON
            </button>
            <button data-tab="tab-raw" class="px-3 py-3 text-sm font-medium border-b-2 text-gray-500 border-transparent hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
              Raw
            </button>
            <button data-tab="tab-overlays" class="px-3 py-3 text-sm font-medium border-b-2 text-gray-500 border-transparent hover:text-gray-700 dark:hover:text-gray-300 transition-colors relative">
              Overlays
              <span id="overlay-badge" class="hidden ml-1 px-1.5 py-0.5 text-xs rounded-full bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400">0</span>
            </button>
          </nav>
        </div>

        <!-- Tab panels -->
        <div class="flex-1 overflow-auto p-4">

          <!-- Preview -->
          <div data-panel="tab-preview">
            <iframe id="preview-iframe" class="w-full min-h-[500px] rounded border border-gray-200 dark:border-gray-700 bg-white" sandbox="allow-same-origin"></iframe>
          </div>

          <!-- Markdown -->
          <div data-panel="tab-markdown" class="hidden">
            <div class="flex gap-2 mb-3 justify-end">
              <button id="copy-markdown" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Copy</button>
              <button id="download-markdown" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Download</button>
            </div>
            <pre id="result-markdown" class="text-sm font-mono whitespace-pre-wrap bg-gray-50 dark:bg-gray-900 rounded-lg p-4 max-h-[600px] overflow-auto"></pre>
          </div>

          <!-- Text -->
          <div data-panel="tab-text" class="hidden">
            <div class="flex gap-2 mb-3 justify-end">
              <button id="copy-text" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Copy</button>
              <button id="download-text" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Download</button>
            </div>
            <pre id="result-text" class="text-sm font-mono whitespace-pre-wrap bg-gray-50 dark:bg-gray-900 rounded-lg p-4 max-h-[600px] overflow-auto"></pre>
          </div>

          <!-- Tables -->
          <div data-panel="tab-tables" class="hidden">
            <div id="tables-container">
              <p class="text-gray-500 dark:text-gray-400 text-sm">No tables found in this document.</p>
            </div>
          </div>

          <!-- JSON -->
          <div data-panel="tab-json" class="hidden">
            <div class="flex gap-2 mb-3 justify-end">
              <button id="copy-json" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Copy</button>
              <button id="download-json" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Download</button>
            </div>
            <pre id="result-json" class="text-sm font-mono whitespace-pre-wrap bg-gray-50 dark:bg-gray-900 rounded-lg p-4 max-h-[600px] overflow-auto"></pre>
          </div>

          <!-- Raw -->
          <div data-panel="tab-raw" class="hidden">
            <div class="flex gap-2 mb-3 justify-end">
              <button id="copy-raw" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Copy</button>
              <button id="download-raw" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Download</button>
            </div>
            <pre id="result-raw" class="text-sm font-mono whitespace-pre-wrap bg-gray-50 dark:bg-gray-900 rounded-lg p-4 max-h-[600px] overflow-auto"></pre>
          </div>

          <!-- Overlays -->
          <div data-panel="tab-overlays" class="hidden">
            <div id="overlay-container">
              <p class="text-gray-500 dark:text-gray-400 text-sm">No overlays detected.</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-200 dark:border-gray-700 mt-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm text-gray-500 dark:text-gray-400">
      <span>Powered by IBM Granite Docling via WebGPU</span>
      <span>Built with <a href="https://github.com/btwld/docling-sdk" class="text-blue-600 dark:text-blue-400 hover:underline">docling-sdk</a></span>
    </div>
  </footer>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
